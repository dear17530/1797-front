{"version":3,"sources":["webpack:///./src/views/UserMessage.vue?c7c0","webpack:///src/views/UserMessage.vue","webpack:///./src/views/UserMessage.vue?88bb","webpack:///./src/views/UserMessage.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","circular","align","_l","friend","i","key","on","$event","showMessage","_id","avatar","_v","_s","userId","age","birthday","introduction","directives","name","rawName","value","form","expression","ref","message","date","sender","user","type","indexOf","_k","keyCode","submit","apply","arguments","model","callback","$$v","$set","slot","staticRenderFns","data","friends","messages","profile","receiver","valid","birthdayTime","birthMonth","birthDay","nowTime","messageLength","computed","getMessageLength","length","methods","getIntroduction","undefined","getAge","Math","ceil","getConstellation","delayUpdate","Promise","watch","handler","islogin","clearInterval","timer","deep","destroyed","component","VAvatar","VCol","VContainer","VIcon","VRow","VTextField"],"mappings":"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","file":"js/UserMessage.a65c559f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{attrs:{\"id\":\"userMessage\"}},[_c('v-row',{staticClass:\"ma-0 mb-2\",attrs:{\"id\":\"friends\"}},[_c('Flicking',{attrs:{\"options\":{ circular: false, align: 'prev' }}},_vm._l((_vm.friends),function(friend,i){return _c('div',{key:i,staticClass:\"friend mx-2 d-flex justify-center\",on:{\"click\":function($event){return _vm.showMessage(friend._id)}}},[_c('div',{staticClass:\"d-flex justify-center align-center px-3\"},[_c('v-avatar',{attrs:{\"size\":\"60\"}},[_c('img',{attrs:{\"src\":friend.avatar[0]}})])],1),_c('div',{staticClass:\"d-flex flex-column justify-center pa-3\"},[_c('span',{staticClass:\"mr-2 body-1 font-weight-bold\"},[_vm._v(_vm._s(friend.userId))]),_c('span',{staticClass:\"mr-2 text-caption\"},[_vm._v(_vm._s(friend.age)+\" \"+_vm._s(friend.birthday))]),_c('p',{staticClass:\"mb-0 text-caption\"},[_vm._v(_vm._s(friend.introduction))])])])}),0)],1),_c('v-row',{staticClass:\"ma-0 mb-2\",attrs:{\"id\":\"message\"}},[_c('v-col',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.form.receiver),expression:\"form.receiver\"}],ref:\"scroll\",attrs:{\"id\":\"allDialogBox\",\"cols\":\"12\"}},_vm._l((_vm.messages),function(message){return _c('v-row',{key:message.date,staticClass:\"ma-0\"},[(message.sender._id === _vm.user._id)?_c('v-col',{staticClass:\"text-right\",attrs:{\"cols\":\"12\"}},[_c('span',{staticClass:\"dialogBox mr-2\"},[_vm._v(_vm._s(message.message))]),_c('v-avatar',{staticClass:\"mr-3\",attrs:{\"size\":\"25\"}},[_c('img',{attrs:{\"src\":message.sender.avatar[0]}})])],1):_c('v-col',{staticClass:\"text-left\"},[_c('v-avatar',{staticClass:\"mr-3\",attrs:{\"size\":\"25\"}},[_c('img',{attrs:{\"src\":message.sender.avatar[0]}})]),_c('span',{staticClass:\"dialogBox mr-2\"},[_vm._v(_vm._s(message.message))])],1)],1)}),1),_c('v-col',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.form.receiver),expression:\"form.receiver\"}],staticClass:\"mt-auto\",attrs:{\"cols\":\"12\"}},[_c('v-row',[_c('v-col',{attrs:{\"cols\":\"12\",\"id\":\"txt\"}},[_c('v-text-field',{ref:\"form\",attrs:{\"outline\":\"\",\"rounded\":\"\",\"hide-details\":\"\"},on:{\"keydown\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.submit.apply(null, arguments)}},model:{value:(_vm.form.message),callback:function ($$v) {_vm.$set(_vm.form, \"message\", $$v)},expression:\"form.message\"}},[_c('v-icon',{attrs:{\"slot\":\"append\",\"color\":\"grey\"},on:{\"click\":_vm.submit},slot:\"append\"},[_vm._v(\"mdi-send-circle-outline\")])],1)],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\nv-container#userMessage\n  v-row#friends.ma-0.mb-2\n    Flicking(:options=\"{ circular: false, align: 'prev' }\")\n      div(v-for='(friend, i) in friends' :key='i' @click='showMessage(friend._id)').friend.mx-2.d-flex.justify-center\n        div.d-flex.justify-center.align-center.px-3\n          v-avatar(size=\"60\")\n            img(:src='friend.avatar[0]')\n        div.d-flex.flex-column.justify-center.pa-3\n          span.mr-2.body-1.font-weight-bold {{ friend.userId }}\n          span.mr-2.text-caption {{ friend.age }} {{ friend.birthday }}\n          p.mb-0.text-caption {{ friend.introduction }}\n  v-row#message.ma-0.mb-2\n    v-col#allDialogBox(ref='scroll' cols='12' v-show='form.receiver')\n      v-row.ma-0(v-for='message in messages' :key='message.date')\n        v-col(v-if='message.sender._id === user._id' cols='12').text-right\n          span.dialogBox.mr-2 {{ message.message }}\n          v-avatar(size=\"25\").mr-3\n            img(:src='message.sender.avatar[0]')\n        v-col(v-else).text-left\n          v-avatar(size=\"25\").mr-3\n            img(:src='message.sender.avatar[0]')\n          span.dialogBox.mr-2 {{ message.message }}\n    v-col(cols='12' v-show='form.receiver').mt-auto\n      v-row\n        v-col(cols='12')#txt\n          v-text-field(ref=\"form\" v-model='form.message' outline rounded @keydown.enter='submit' hide-details)\n            v-icon(slot='append' color='grey' @click='submit') mdi-send-circle-outline\n</template>\n<script src=\"https://unpkg.com/@egjs/flicking/dist/flicking.pkgd.min.js\" crossorigin=\"anonymous\"></script>\n<script>\nimport '@/scss/userMessage.scss'\n\nexport default {\n  name: 'UserMessage',\n  data () {\n    return {\n      friends: [],\n      messages: [],\n      profile: [],\n      form: {\n        message: '',\n        sender: '',\n        receiver: ''\n      },\n      valid: true,\n      birthdayTime: 0,\n      birthMonth: 0,\n      birthDay: 0,\n      nowTime: 0,\n      messageLength: 0\n    }\n  },\n  computed: {\n    getMessageLength () {\n      return this.messages.length\n    }\n  },\n  methods: {\n    getIntroduction (introduction) {\n      if (introduction === undefined || introduction === '') {\n        return '這個人很懶，什麼都沒留下。'\n      } else {\n        return introduction\n      }\n    },\n    getAge (birthday) {\n      const nowTime = parseInt(new Date().getTime())\n      return Math.ceil((nowTime - birthday) / 31536000000) + '歲'\n    },\n    getConstellation (birthday) {\n      const birthDay = new Date(birthday).getDate()\n      const birthMonth = new Date(birthday).getMonth() + 1\n      if ((birthMonth === 3 && birthDay >= 21) || (birthMonth === 4 && birthDay <= 19)) {\n        return '牡羊座'\n      } else if ((birthMonth === 4 && birthDay >= 20) || (birthMonth === 5 && birthDay <= 20)) {\n        return '金牛座'\n      } else if ((birthMonth === 5 && birthDay >= 21) || (birthMonth === 6 && birthDay <= 21)) {\n        return '雙子座'\n      } else if ((birthMonth === 6 && birthDay >= 22) || (birthMonth === 7 && birthDay <= 22)) {\n        return '巨蟹座'\n      } else if ((birthMonth === 7 && birthDay >= 23) || (birthMonth === 8 && birthDay <= 22)) {\n        return '獅子座'\n      } else if ((birthMonth === 8 && birthDay >= 23) || (birthMonth === 9 && birthDay <= 22)) {\n        return '處女座'\n      } else if ((birthMonth === 9 && birthDay >= 23) || (birthMonth === 10 && birthDay <= 23)) {\n        return '天秤座'\n      } else if ((birthMonth === 10 && birthDay >= 24) || (birthMonth === 11 && birthDay <= 22)) {\n        return '天蠍座'\n      } else if ((birthMonth === 11 && birthDay >= 23) || (birthMonth === 12 && birthDay <= 21)) {\n        return '射手座'\n      } else if ((birthMonth === 12 && birthDay >= 22) || (birthMonth === 1 && birthDay <= 19)) {\n        return '魔羯座'\n      } else if ((birthMonth === 1 && birthDay >= 20) || (birthMonth === 2 && birthDay <= 18)) {\n        return '水瓶座'\n      } else {\n        return '雙魚座'\n      }\n    },\n    async submit () {\n      if (!this.$refs.form.validate()) {\n        this.$swal({\n          icon: 'error',\n          title: '錯誤',\n          text: '請填寫資料'\n        })\n      }\n      const data = {\n        message: this.form.message,\n        receiver: this.form.receiver\n      }\n      await this.axios.post('/messages', data, {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.form.message = ''\n    },\n    async showMessage (id) {\n      this.form.receiver = id\n      const { data } = await this.axios.get('/messages/' + id, {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.messages = data.result.map(item => {\n        if (item.receiver.imagefiles.length === 0) {\n          item.receiver.avatar[0] = `${process.env.VUE_APP_API}/files/${item.receiver.avatar[0]}`\n        } else {\n          item.receiver.avatar[0] = `${process.env.VUE_APP_API}/files/${item.receiver.imagefiles[0]}`\n          item.receiver.imagefiles = []\n        }\n        if (item.sender.imagefiles.length === 0) {\n          item.sender.avatar[0] = `${process.env.VUE_APP_API}/files/${item.sender.avatar[0]}`\n        } else {\n          item.sender.avatar[0] = `${process.env.VUE_APP_API}/files/${item.sender.imagefiles[0]}`\n          item.receiver.imagefiles = []\n        }\n        return item\n      })\n    },\n    async update () {\n      if (!this.form.receiver) return\n      const { data } = await this.axios.get('/messages/' + this.form.receiver, {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.messages = data.result.map(item => {\n        if (item.receiver.imagefiles.length === 0) {\n          item.receiver.avatar[0] = `${process.env.VUE_APP_API}/files/${item.receiver.avatar[0]}`\n        } else {\n          item.receiver.avatar[0] = `${process.env.VUE_APP_API}/files/${item.receiver.imagefiles[0]}`\n          item.receiver.imagefiles = []\n        }\n        if (item.sender.imagefiles.length === 0) {\n          item.sender.avatar[0] = `${process.env.VUE_APP_API}/files/${item.sender.avatar[0]}`\n        } else {\n          item.sender.avatar[0] = `${process.env.VUE_APP_API}/files/${item.sender.imagefiles[0]}`\n          item.receiver.imagefiles = []\n        }\n        return item\n      })\n    },\n    delayUpdate (ms) {\n      return new Promise((resolve) => setTimeout(resolve, ms))\n    }\n  },\n  async mounted () {\n    if (this.user.islogin) {\n      this.timer = setInterval(this.update, 1000)\n    }\n    try {\n      const { data } = await this.axios.get('/users/' + this.$store.state.user._id + '/friend', {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.friends = data.result.friend.map(item => {\n        item = { ...item.user_id }\n        if (item.imagefiles.length === 0) {\n          item.avatar = item.avatar.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n        } else {\n          item.avatar = item.imagefiles.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n        }\n        item.age = this.getAge(new Date(item.birthday).getTime())\n        item.birthday = this.getConstellation(new Date(item.birthday).getTime())\n        item.introduction = this.getIntroduction(item.introduction)\n        return item\n      })\n      this.form.receiver = this.friends[0]._id\n    } catch (error) {\n      this.$swal({\n        icon: 'error',\n        title: '錯誤',\n        text: '取得資料失敗'\n      })\n    }\n  },\n  watch: {\n    'user.islogin': {\n      handler: function () {\n        if (!this.user.islogin) {\n          clearInterval(this.timer)\n        }\n      },\n      deep: true\n    },\n    getMessageLength: {\n      handler: async function () {\n        const oldvalue = this.messages.length\n        const delay = 1000\n        await this.delayUpdate(delay)\n        const newvalue = this.getMessageLength\n        if (oldvalue !== newvalue) {\n          this.$refs.scroll.scrollTop = this.$refs.scroll.scrollHeight\n        }\n      },\n      deep: true\n    }\n  },\n  destroyed () {\n    clearInterval(this.timer)\n  }\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserMessage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserMessage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UserMessage.vue?vue&type=template&id=7e2dd360&lang=pug&\"\nimport script from \"./UserMessage.vue?vue&type=script&lang=js&\"\nexport * from \"./UserMessage.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAvatar } from 'vuetify/lib/components/VAvatar';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VAvatar,VCol,VContainer,VIcon,VRow,VTextField})\n"],"sourceRoot":""}