(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["UserMessage"],{"7af0":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{id:"userMessage"}},[r("v-row",{staticClass:"ma-0 mb-2",attrs:{id:"friends"}},[r("Flicking",{attrs:{options:{circular:!1,align:"prev"}}},e._l(e.friends,(function(t,a){return r("div",{key:a,staticClass:"friend mx-2 d-flex justify-center",style:{background:t.bg},on:{click:function(r){return e.showMessage(t._id,a)}}},[r("div",{staticClass:"d-flex justify-center align-center px-3"},[r("v-avatar",{attrs:{size:"60"}},[r("img",{attrs:{src:t.avatar[0]}})])],1),r("div",{staticClass:"d-flex flex-column justify-center pa-3"},[r("span",{staticClass:"mr-2 body-1 font-weight-bold"},[e._v(e._s(t.userId))]),r("span",{staticClass:"mr-2 text-caption"},[e._v(e._s(t.age)+" "+e._s(t.birthday))]),r("p",{staticClass:"mb-0 text-caption"},[e._v(e._s(t.introduction))])])])})),0)],1),r("v-row",{staticClass:"ma-0 mb-2",attrs:{id:"message"}},[r("v-col",{directives:[{name:"show",rawName:"v-show",value:e.form.receiver,expression:"form.receiver"}],ref:"scroll",attrs:{id:"allDialogBox",cols:"12"}},e._l(e.messages,(function(t){return r("v-row",{key:t.date,staticClass:"ma-0"},[!0===t.welcomeMessage&&t.sender._id!==e.user._id?r("v-col",{staticClass:"text-left col-12"},[r("v-avatar",{staticClass:"mr-3",attrs:{size:"25"}},[r("img",{attrs:{src:t.sender.avatar[0]}})]),r("span",{staticClass:"d-inline-flex ml-9 ml-md-0 dialogBox mr-2 pointer"},[e._v("歡迎加入！您可以直接點擊下列問題，若無您要詢問的問題，請手動輸入。")]),r("br"),r("span",{staticClass:"d-inline-flex my-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(1)}}},[e._v("我該如何發起活動？")]),r("br"),r("span",{staticClass:"d-inline-flex mb-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(2)}}},[e._v("我該如何編輯活動？")]),r("br"),r("span",{staticClass:"d-inline-flex mb-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(3)}}},[e._v("我該如何查看有誰參與了我的活動？")]),r("br"),r("span",{staticClass:"d-inline-flex mb-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(4)}}},[e._v("我該如何參與他人的活動？")]),r("br"),r("span",{staticClass:"d-inline-flex mb-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(5)}}},[e._v("我該如何私訊主辦人？")]),r("br"),r("span",{staticClass:"d-inline-flex mb-3 ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(6)}}},[e._v("回饋點數可以怎麼使用？")]),r("br"),r("span",{staticClass:"d-inline-flex ml-9 dialogBox mr-2 pointer",on:{click:function(t){return e.question(7)}}},[e._v("回饋點數怎麼獲得？")])],1):!1===t.welcomeMessage&&t.sender._id===e.user._id?r("v-col",{staticClass:"text-right",attrs:{cols:"12"}},[r("span",{staticClass:"d-inline-flex dialogBox mr-2"},[e._v(e._s(t.message))]),r("v-avatar",{staticClass:"mr-3",attrs:{size:"25"}},[r("img",{attrs:{src:t.sender.avatar[0]}})])],1):!1===t.welcomeMessage&&t.sender._id!==e.user._id?r("v-col",{staticClass:"text-left",attrs:{cols:"12"}},[r("v-avatar",{staticClass:"mr-3",attrs:{size:"25"}},[r("img",{attrs:{src:t.sender.avatar[0]}})]),r("span",{staticClass:"d-inline-flex dialogBox mr-2"},[e._v(e._s(t.message))])],1):e._e()],1)})),1),r("v-col",{directives:[{name:"show",rawName:"v-show",value:e.form.receiver,expression:"form.receiver"}],staticClass:"mt-auto",attrs:{cols:"12"}},[r("v-row",[r("v-col",{attrs:{cols:"12",id:"txt"}},[r("v-text-field",{ref:"form",attrs:{outline:"",rounded:"","hide-details":""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}},model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}},[r("v-icon",{attrs:{slot:"append",color:"grey"},on:{click:e.submit},slot:"append"},[e._v("mdi-send-circle-outline")])],1)],1)],1)],1)],1)],1)},s=[],n=r("5530"),i=r("1da1"),o=(r("d81d"),r("99af"),r("d3b7"),r("96cf"),r("9bdf"),{name:"UserMessage",data:function(){return{friends:[],messages:[],profile:[],form:{message:"",sender:"",receiver:""},valid:!0,birthdayTime:0,birthMonth:0,birthDay:0,nowTime:0,messageLength:0,index:0}},computed:{getMessageLength:function(){return this.messages.length}},methods:{getIntroduction:function(e){return void 0===e||""===e?"這個人很懶，什麼都沒留下。":e},getAge:function(e){var t=parseInt((new Date).getTime());return Math.ceil((t-e)/31536e6)+"歲"},getConstellation:function(e){var t=new Date(e).getDate(),r=new Date(e).getMonth()+1;return 3===r&&t>=21||4===r&&t<=19?"牡羊座":4===r&&t>=20||5===r&&t<=20?"金牛座":5===r&&t>=21||6===r&&t<=21?"雙子座":6===r&&t>=22||7===r&&t<=22?"巨蟹座":7===r&&t>=23||8===r&&t<=22?"獅子座":8===r&&t>=23||9===r&&t<=22?"處女座":9===r&&t>=23||10===r&&t<=23?"天秤座":10===r&&t>=24||11===r&&t<=22?"天蠍座":11===r&&t>=23||12===r&&t<=21?"射手座":12===r&&t>=22||1===r&&t<=19?"魔羯座":1===r&&t>=20||2===r&&t<=18?"水瓶座":"雙魚座"},question:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,s,n,i,o,c,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(1!==e){r.next=6;break}return a={message:"我該如何發起活動？",receiver:t.form.receiver},r.next=4,t.axios.post("/messages",a,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 4:r.next=40;break;case 6:if(2!==e){r.next=12;break}return s={message:"我該如何編輯活動？",receiver:t.form.receiver},r.next=10,t.axios.post("/messages",s,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 10:r.next=40;break;case 12:if(3!==e){r.next=18;break}return n={message:"我該如何查看有誰參與了我的活動？",receiver:t.form.receiver},r.next=16,t.axios.post("/messages",n,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 16:r.next=40;break;case 18:if(4!==e){r.next=24;break}return i={message:"我該如何參與他人的活動？",receiver:t.form.receiver},r.next=22,t.axios.post("/messages",i,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 22:r.next=40;break;case 24:if(5!==e){r.next=30;break}return o={message:"我該如何私訊主辦人？",receiver:t.form.receiver},r.next=28,t.axios.post("/messages",o,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 28:r.next=40;break;case 30:if(6!==e){r.next=36;break}return c={message:"回饋點數可以怎麼使用？",receiver:t.form.receiver},r.next=34,t.axios.post("/messages",c,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 34:r.next=40;break;case 36:if(7!==e){r.next=40;break}return l={message:"回饋點數怎麼獲得？",receiver:t.form.receiver},r.next=40,t.axios.post("/messages",l,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 40:case"end":return r.stop()}}),r)})))()},submit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.form.validate()||e.$swal({icon:"error",title:"錯誤",text:"請填寫資料"}),r={message:e.form.message,receiver:e.form.receiver},t.next=4,e.axios.post("/messages",r,{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:e.form.message="";case 5:case"end":return t.stop()}}),t)})))()},showMessage:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(r.index=t,s=0;s<r.friends.length;s++)s===r.index?r.friends[s].bg="#ffcec9":r.friends[s].bg="#fff3f2";return r.form.receiver=e,a.next=5,r.axios.get("/messages/"+e,{headers:{authorization:"Bearer "+r.$store.state.jwt.token}});case 5:n=a.sent,i=n.data,r.messages=i.result.map((function(e){return 0===e.receiver.imagefiles.length?e.receiver.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.receiver.avatar[0]):(e.receiver.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.receiver.imagefiles[0]),e.receiver.imagefiles=[]),0===e.sender.imagefiles.length?e.sender.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.sender.avatar[0]):(e.sender.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.sender.imagefiles[0]),e.receiver.imagefiles=[]),e}));case 8:case"end":return a.stop()}}),a)})))()},update:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form.receiver){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.axios.get("/messages/"+e.form.receiver,{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:r=t.sent,a=r.data,e.messages=a.result.map((function(e){return 0===e.receiver.imagefiles.length?e.receiver.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.receiver.avatar[0]):(e.receiver.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.receiver.imagefiles[0]),e.receiver.imagefiles=[]),0===e.sender.imagefiles.length?e.sender.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.sender.avatar[0]):(e.sender.avatar[0]="".concat("https://one797back.onrender.com/","/files/").concat(e.sender.imagefiles[0]),e.receiver.imagefiles=[]),e}));case 7:case"end":return t.stop()}}),t)})))()},delayUpdate:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.user.islogin&&(e.timer=setInterval(e.update,1e3)),t.prev=1,t.next=4,e.axios.get("/users/"+e.$store.state.user._id+"/friend",{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:r=t.sent,a=r.data,e.friends=a.result.friend.map((function(t){return t=Object(n["a"])({},t.user_id),0===t.imagefiles.length?t.avatar=t.avatar.map((function(e){return"".concat("https://one797back.onrender.com/","/files/").concat(e)})):t.avatar=t.imagefiles.map((function(e){return"".concat("https://one797back.onrender.com/","/files/").concat(e)})),t.age=e.getAge(new Date(t.birthday).getTime()),t.birthday=e.getConstellation(new Date(t.birthday).getTime()),t.introduction=e.getIntroduction(t.introduction),t.bg="#fff3f2",t})),e.form.receiver=e.friends[0]._id,e.friends[0].bg="#ffcec9",t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),e.$swal({icon:"error",title:"錯誤",text:"取得資料失敗"});case 14:case"end":return t.stop()}}),t,null,[[1,11]])})))()},watch:{"user.islogin":{handler:function(){this.user.islogin||clearInterval(this.timer)},deep:!0},getMessageLength:{handler:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.messages.length,r=1e3,e.next=4,this.delayUpdate(r);case 4:a=this.getMessageLength,t!==a&&(this.$refs.scroll.scrollTop=this.$refs.scroll.scrollHeight);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deep:!0}},destroyed:function(){clearInterval(this.timer)}}),c=o,l=r("2877"),u=r("6544"),m=r.n(u),d=r("8212"),f=r("62ad"),g=r("a523"),v=r("132d"),h=r("0fd9"),p=r("8654"),x=Object(l["a"])(c,a,s,!1,null,null,null);t["default"]=x.exports;m()(x,{VAvatar:d["a"],VCol:f["a"],VContainer:g["a"],VIcon:v["a"],VRow:h["a"],VTextField:p["a"]})},"9bdf":function(e,t,r){}}]);
//# sourceMappingURL=UserMessage.5fc620a2.js.map