(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["UserMessage"],{"7af0":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{id:"userMessage"}},[r("v-row",{staticClass:"ma-0 mb-2",attrs:{id:"friends"}},[r("Flicking",e._l(e.friends,(function(t,a){return r("div",{key:t._id,staticClass:"friend mx-2 d-flex justify-center",on:{click:function(r){return e.showMessage(t._id)}}},[r("div",{staticClass:"d-flex justify-center align-center px-3"},[r("v-avatar",{attrs:{size:"60"}},[r("img",{attrs:{src:t.avatar[0]}})])],1),r("div",{staticClass:"d-flex flex-column justify-center pa-3"},[r("span",{staticClass:"mr-2 body-1 font-weight-bold"},[e._v(e._s(t.userId))]),r("span",{staticClass:"mr-2 text-caption"},[e._v(e._s(t.age)+" "+e._s(t.birthday))]),r("p",{staticClass:"mb-0 text-caption"},[e._v(e._s(t.introduction))])])])})),0)],1),r("v-row",{staticClass:"ma-0 mb-2",attrs:{id:"message"}},[r("v-col",{directives:[{name:"show",rawName:"v-show",value:e.form.receiver,expression:"form.receiver"}],ref:"scroll",attrs:{id:"allDialogBox",cols:"12"}},e._l(e.messages,(function(t){return r("v-row",{key:t.date,staticClass:"ma-0"},[t.sender._id===e.user._id?r("v-col",{staticClass:"text-right",attrs:{cols:"12"}},[r("span",{staticClass:"dialogBox mr-2"},[e._v(e._s(t.message))]),r("v-avatar",{staticClass:"mr-3",attrs:{size:"25"}},[r("img",{attrs:{src:t.sender.avatar[0]}})])],1):r("v-col",{staticClass:"text-left"},[r("v-avatar",{staticClass:"mr-3",attrs:{size:"25"}},[r("img",{attrs:{src:t.sender.avatar[0]}})]),r("span",{staticClass:"dialogBox mr-2"},[e._v(e._s(t.message))])],1)],1)})),1),r("v-col",{directives:[{name:"show",rawName:"v-show",value:e.form.receiver,expression:"form.receiver"}],staticClass:"mt-auto",attrs:{cols:"12"}},[r("v-row",[r("v-col",{attrs:{cols:"12",id:"txt"}},[r("v-text-field",{ref:"form",attrs:{outline:"",rounded:"","hide-details":""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}},model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}},[r("v-icon",{attrs:{slot:"append",color:"grey"},on:{click:e.submit},slot:"append"},[e._v("mdi-send-circle-outline")])],1)],1)],1)],1)],1)],1)},s=[],n=r("5530"),i=r("1da1"),o=(r("d81d"),r("99af"),r("d3b7"),r("96cf"),r("9bdf"),{name:"UserMessage",data:function(){return{friends:[],messages:[],profile:[],form:{message:"",sender:"",receiver:""},valid:!0,birthdayTime:0,birthMonth:0,birthDay:0,nowTime:0,messageLength:0}},computed:{getMessageLength:function(){return this.messages.length}},methods:{getIntroduction:function(e){return void 0===e||""===e?"這個人很懶，什麼都沒留下。":e},getAge:function(e){var t=parseInt((new Date).getTime());return Math.ceil((t-e)/31536e6)+"歲"},getConstellation:function(e){var t=new Date(e).getDate(),r=new Date(e).getMonth()+1;return 3===r&&t>=21||4===r&&t<=19?"牡羊座":4===r&&t>=20||5===r&&t<=20?"金牛座":5===r&&t>=21||6===r&&t<=21?"雙子座":6===r&&t>=22||7===r&&t<=22?"巨蟹座":7===r&&t>=23||8===r&&t<=22?"獅子座":8===r&&t>=23||9===r&&t<=22?"處女座":9===r&&t>=23||10===r&&t<=23?"天秤座":10===r&&t>=24||11===r&&t<=22?"天蠍座":11===r&&t>=23||12===r&&t<=21?"射手座":12===r&&t>=22||1===r&&t<=19?"魔羯座":1===r&&t>=20||2===r&&t<=18?"水瓶座":"雙魚座"},submit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.form.validate()||e.$swal({icon:"error",title:"錯誤",text:"請填寫資料"}),r={message:e.form.message,receiver:e.form.receiver},t.next=4,e.axios.post("/messages",r,{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:e.form.message="";case 5:case"end":return t.stop()}}),t)})))()},showMessage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.form.receiver=e,r.next=3,t.axios.get("/messages/"+e,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:a=r.sent,s=a.data,t.messages=s.result.map((function(e){return 0===e.receiver.imagefiles.length?e.receiver.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.receiver.avatar[0]):(e.receiver.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.receiver.imagefiles[0]),e.receiver.imagefiles=[]),0===e.sender.imagefiles.length?e.sender.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.sender.avatar[0]):(e.sender.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.sender.imagefiles[0]),e.receiver.imagefiles=[]),e}));case 6:case"end":return r.stop()}}),r)})))()},update:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form.receiver){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.axios.get("/messages/"+e.form.receiver,{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:r=t.sent,a=r.data,e.messages=a.result.map((function(e){return 0===e.receiver.imagefiles.length?e.receiver.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.receiver.avatar[0]):(e.receiver.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.receiver.imagefiles[0]),e.receiver.imagefiles=[]),0===e.sender.imagefiles.length?e.sender.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.sender.avatar[0]):(e.sender.avatar[0]="".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e.sender.imagefiles[0]),e.receiver.imagefiles=[]),e}));case 7:case"end":return t.stop()}}),t)})))()},delayUpdate:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.user.islogin&&(e.timer=setInterval(e.update,1e3)),t.prev=1,t.next=4,e.axios.get("/users/"+e.$store.state.user._id+"/friend",{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 4:r=t.sent,a=r.data,e.friends=a.result.friend.map((function(t){return t=Object(n["a"])({},t.user_id),0===t.imagefiles.length?t.avatar=t.avatar.map((function(e){return"".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e)})):t.avatar=t.imagefiles.map((function(e){return"".concat("https://kt17977777777777.herokuapp.com","/files/").concat(e)})),t.age=e.getAge(new Date(t.birthday).getTime()),t.birthday=e.getConstellation(new Date(t.birthday).getTime()),t.introduction=e.getIntroduction(t.introduction),t})),e.form.receiver=e.friends[0]._id,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),e.$swal({icon:"error",title:"錯誤",text:"取得資料失敗"});case 13:case"end":return t.stop()}}),t,null,[[1,10]])})))()},watch:{"user.islogin":{handler:function(){this.user.islogin||clearInterval(this.timer)},deep:!0},getMessageLength:{handler:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.messages.length,r=1e3,e.next=4,this.delayUpdate(r);case 4:a=this.getMessageLength,t!==a&&(this.$refs.scroll.scrollTop=this.$refs.scroll.scrollHeight);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deep:!0}}}),c=o,l=r("2877"),u=r("6544"),m=r.n(u),d=r("8212"),f=r("62ad"),v=r("a523"),g=r("132d"),p=r("0fd9"),h=r("8654"),w=Object(l["a"])(c,a,s,!1,null,null,null);t["default"]=w.exports;m()(w,{VAvatar:d["a"],VCol:f["a"],VContainer:v["a"],VIcon:g["a"],VRow:p["a"],VTextField:h["a"]})},"9bdf":function(e,t,r){}}]);
//# sourceMappingURL=UserMessage.495bb220.js.map