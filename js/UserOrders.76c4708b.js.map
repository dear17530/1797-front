{"version":3,"sources":["webpack:///./src/views/UserOrders.vue?fafc","webpack:///src/views/UserOrders.vue","webpack:///./src/views/UserOrders.vue?c1ab","webpack:///./src/views/UserOrders.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","headers","orders","expanded","on","clicked","scopedSlots","_u","key","fn","ref","item","length","state","$event","editstate","_v","_e","staticRenderFns","name","data","search","editedIndex","singleExpand","components","OrderCard","methods","push","value","component","VBtn","VDataTable","VIcon"],"mappings":"qHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,6BAA6BC,MAAM,CAAC,GAAK,eAAe,CAACH,EAAG,MAAM,CAACA,EAAG,eAAe,CAACG,MAAM,CAAC,QAAUP,EAAIQ,QAAQ,MAAQR,EAAIS,OAAO,SAAWT,EAAIU,SAAS,WAAW,MAAM,cAAc,IAAIC,GAAG,CAAC,YAAYX,EAAIY,SAASC,YAAYb,EAAIc,GAAG,CAAC,CAACC,IAAI,gBAAgBC,GAAG,SAASC,GACzY,IAAIC,EAAOD,EAAIC,KACf,MAAO,CAACd,EAAG,KAAK,CAACE,YAAY,OAAOC,MAAM,CAAC,QAAUP,EAAIQ,QAAQW,OAAO,IAAI,CAACf,EAAG,YAAY,CAACG,MAAM,CAAC,KAAOW,MAAS,MAAM,CAACH,IAAI,eAAeC,GAAG,SAASC,GAC1J,IAAIC,EAAOD,EAAIC,KACf,MAAO,CAAiB,QAAfA,EAAKE,MAAiBhB,EAAG,QAAQ,CAACG,MAAM,CAAC,QAAU,GAAG,MAAQ,GAAG,MAAQ,WAAWI,GAAG,CAAC,MAAQ,SAASU,GAAQ,OAAOrB,EAAIsB,UAAUJ,MAAS,CAACd,EAAG,SAAS,CAACG,MAAM,CAAC,KAAO,GAAG,MAAQ,UAAU,CAACP,EAAIuB,GAAG,wCAAwCnB,EAAG,OAAO,CAACE,YAAY,eAAe,CAACN,EAAIuB,GAAG,WAAW,GAAGvB,EAAIwB,aAAa,MAClUC,EAAkB,G,wFCWtB,GACEC,KAAM,aACNC,KAFF,WAGI,MAAO,CACLC,OAAQ,GACRnB,OAAQ,GACRoB,aAAc,EACdnB,SAAU,CAAC,UACXoB,cAAc,EACdtB,QAAS,CACf,CACQ,KAAR,OACQ,MAAR,SACQ,MAAR,MACQ,UAAR,GAEA,CAAQ,KAAR,KAAQ,MAAR,WACA,CAAQ,KAAR,OAAQ,MAAR,kBACA,CAAQ,KAAR,OAAQ,MAAR,QACA,CAAQ,KAAR,MAAQ,MAAR,OACA,CAAQ,KAAR,OAAQ,MAAR,UACA,CAAQ,KAAR,OAAQ,MAAR,kBACA,CAAQ,KAAR,OAAQ,MAAR,WACA,CAAQ,KAAR,OAAQ,MAAR,mBACA,CAAQ,KAAR,OAAQ,MAAR,SACA,CAAQ,MAAR,UAAQ,UAAR,MAIEuB,WAAY,CACVC,UAAJ,QAEEC,QAAS,CACPrB,QADJ,SACA,GACMX,KAAKS,SAASwB,KAAKC,IAErB,UAJJ,SAIA,qLACA,+CACA,SACA,oDAHA,OAMA,IANA,YAMA,qBANA,gCAOA,4DACA,SACA,oDATA,OAMA,IANA,uCAaA,uCACA,SACA,oDAfA,yBAkBA,iCACA,SACA,oDApBA,iBAkBA,EAlBA,EAkBA,KAKA,mCAmBA,OAlBA,2BACA,cACA,gBAEA,gBAEA,uCAUA,OATA,oFACA,oCACA,iFACA,kBAEA,qCACA,4EACA,iBAEA,KAEA,KA1CA,gDA8CE,QAlFF,WAkFA,yLAEA,iCACA,SACA,oDAJA,gBAEA,EAFA,EAEA,KAKA,mCAmBA,OAlBA,2BACA,cACA,gBAEA,gBAEA,uCAUA,OATA,oFACA,oCACA,iFACA,kBAEA,qCACA,4EACA,iBAEA,KAEA,KA1BA,mDA6BA,SACA,aACA,WACA,gBAhCA,6DClGoV,I,qECOhVC,EAAY,eACd,EACArC,EACA0B,GACA,EACA,KACA,KACA,MAIa,aAAAW,EAAiB,QAOhC,IAAkBA,EAAW,CAACC,OAAA,KAAKC,aAAA,KAAWC,QAAA,Q","file":"js/UserOrders.76c4708b.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mt-4 d-flex justify-center\",attrs:{\"id\":\"userorders\"}},[_c('div',[_c('v-data-table',{attrs:{\"headers\":_vm.headers,\"items\":_vm.orders,\"expanded\":_vm.expanded,\"item-key\":\"_id\",\"show-expand\":\"\"},on:{\"click:row\":_vm.clicked},scopedSlots:_vm._u([{key:\"expanded-item\",fn:function(ref){\nvar item = ref.item;\nreturn [_c('td',{staticClass:\"py-4\",attrs:{\"colspan\":_vm.headers.length+1}},[_c('OrderCard',{attrs:{\"item\":item}})],1)]}},{key:\"item.actions\",fn:function(ref){\nvar item = ref.item;\nreturn [(item.state === \"已出貨\")?_c('v-btn',{attrs:{\"rounded\":\"\",\"small\":\"\",\"color\":\"#d3a19c\"},on:{\"click\":function($event){return _vm.editstate(item)}}},[_c('v-icon',{attrs:{\"left\":\"\",\"color\":\"white\"}},[_vm._v(\"mdi-checkbox-marked-circle-outline\")]),_c('span',{staticClass:\"white--text\"},[_vm._v(\"收到包裹\")])],1):_vm._e()]}}])})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang='pug'>\n#userorders.mt-4.d-flex.justify-center\n  div\n    v-data-table(:headers='headers' :items='orders' :expanded='expanded' item-key='_id' show-expand @click:row='clicked')\n      template(v-slot:expanded-item='{ item }').my-2\n        td(:colspan=\"headers.length+1\").py-4\n          OrderCard(:item='item')\n      template(v-slot:item.actions='{ item }' width='20')\n        v-btn(rounded small color='#d3a19c' @click='editstate(item)' v-if=('item.state === \"已出貨\"'))\n          v-icon(left color='white') mdi-checkbox-marked-circle-outline\n          span.white--text 收到包裹\n</template>\n<script>\nimport '@/scss/userorders.scss'\nimport OrderCard from '@/components/OrderCard.vue'\n\nexport default {\n  name: 'UserOrders',\n  data () {\n    return {\n      search: '',\n      orders: [],\n      editedIndex: -1,\n      expanded: ['orders'],\n      singleExpand: false,\n      headers: [\n        {\n          text: '訂單編號',\n          align: 'center',\n          value: '_id',\n          sortable: false\n        },\n        { text: '地址', value: 'address' },\n        { text: '聯絡方式', value: 'contact_number' },\n        { text: '訂單日期', value: 'date' },\n        { text: '總金額', value: 'sum' },\n        { text: '點數折價', value: 'redeem' },\n        { text: '付款方式', value: 'payment_method' },\n        { text: '付款狀態', value: 'payment' },\n        { text: '宅配單號', value: 'delivery_number' },\n        { text: '訂單狀態', value: 'state' },\n        { value: 'actions', sortable: false }\n      ]\n    }\n  },\n  components: {\n    OrderCard\n  },\n  methods: {\n    clicked (value) {\n      this.expanded.push(value)\n    },\n    async editstate (item) {\n      await this.axios.patch('/orders/' + item._id, { state: '訂單完成' }, {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      for (let i = 0; i < item.products.length; i++) {\n        await this.axios.patch('/products/' + item.products[i]._id, { order: item._id }, {\n          headers: {\n            authorization: 'Bearer ' + this.$store.state.jwt.token\n          }\n        })\n      }\n      await this.axios.get('/products/orderQuantity', {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      const { data } = await this.axios.get('/orders/getorders', {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.orders = data.result.map(item => {\n        item.date = item.date.slice(0, 10)\n        if (item.payment === false) {\n          item.payment = '待付款'\n        } else {\n          item.payment = '已付款'\n        }\n        item.products = item.products.map(item => {\n          item = { ...item.product, amount: item.amount, option: item.option }\n          if (item.image === null || item.image.length === 0) {\n            item.image = item.imagefiles.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n            item.imagefiles = []\n          } else {\n            item.image = item.image.concat(item.imagefiles)\n            item.image = item.image.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n            item.imagefiles = []\n          }\n          return item\n        })\n        return item\n      })\n    }\n  },\n  async mounted () {\n    try {\n      const { data } = await this.axios.get('/orders/getorders', {\n        headers: {\n          authorization: 'Bearer ' + this.$store.state.jwt.token\n        }\n      })\n      this.orders = data.result.map(item => {\n        item.date = item.date.slice(0, 10)\n        if (item.payment === false) {\n          item.payment = '待付款'\n        } else {\n          item.payment = '已付款'\n        }\n        item.products = item.products.map(item => {\n          item = { ...item.product, amount: item.amount, option: item.option }\n          if (item.image === null || item.image.length === 0) {\n            item.image = item.imagefiles.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n            item.imagefiles = []\n          } else {\n            item.image = item.image.concat(item.imagefiles)\n            item.image = item.image.map(r => `${process.env.VUE_APP_API}/files/${r}`)\n            item.imagefiles = []\n          }\n          return item\n        })\n        return item\n      })\n    } catch (error) {\n      this.$swal({\n        icon: 'error',\n        title: '錯誤',\n        text: '取得訂單失敗'\n      })\n    }\n  }\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserOrders.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserOrders.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UserOrders.vue?vue&type=template&id=f95a3d60&lang=pug&\"\nimport script from \"./UserOrders.vue?vue&type=script&lang=js&\"\nexport * from \"./UserOrders.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VDataTable,VIcon})\n"],"sourceRoot":""}